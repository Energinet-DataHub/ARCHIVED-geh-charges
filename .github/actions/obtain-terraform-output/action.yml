# Copyright 2020 Energinet DataHub A/S
#
# Licensed under the Apache License, Version 2.0 (the "License2");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: Obtain domain specific Terraform output
description: Obtain domain specific Terraform output. This action assumes terraform have been applied earlier in the workflow.
outputs:
  sql-connection-string-keyvaultsecretname:
    description: "The name of the secret in the keyvault containing the connection string to the charge sql database"
    value: ${{ steps.terraform-output.outputs.sql-connection-string-keyvaultsecretname }}
  kv-charges-name:
    description: "The name of the charges keyvault"
    value: ${{ steps.terraform-output.outputs.kv-charges-name }} 

runs:
  using: composite
  steps:
    - name: Obtain Terraform output
      shell: bash
      id: terraform-output
      working-directory: ./build/infrastructure/main
      run: | 
        echo "::set-output name=sql-connection-string-keyvaultsecretname::$(terraform output sql_connection_string_keyvaultsecretname)"
        echo "::set-output name=kv-charges-name::$(terraform output kv_charges_name)"